<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đặt vé xem phim</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">
    <link rel="stylesheet" href="~/css/Movie.css">
    <link href="~/css/dardmode.css" rel="stylesheet" />
    <link href="~/css/lightmode.css" rel="stylesheet" />
</head>
<body>
    <!-- Ô tìm kiếm sản phẩm -->
        <div class="search-container d-flex justify-content-center mb-4">
            <div class="input-group w-50">
            <input type="text" id="SearchProduct" class="form-control" placeholder="Tìm phim theo tên..." autocomplete="off">
                <button id="searchButton" class="btn btn-primary">🔍 Search</button>
            </div>
        </div>
    <div class="container-fluid py-3">
        <div class="container mt-4">
            <!-- Hero Banner -->
            <div class="section">
                <h2 class="text-center mb-4 section-heading">PHIM HOT</h2>
                <div id="imageSlider" class="carousel slide" data-bs-ride="carousel">
                    <!-- Indicators -->
                    <div class="carousel-indicators">
                        <button type="button" data-bs-target="#imageSlider" data-bs-slide-to="0" class="active"></button>
                        <button type="button" data-bs-target="#imageSlider" data-bs-slide-to="1"></button>
                        <button type="button" data-bs-target="#imageSlider" data-bs-slide-to="2"></button>
                    </div>

                    <!-- Slides -->

                    <div class="carousel-inner rounded">
                        @{
                            bool firstItem = true;
                        }  @* Biến kiểm tra phần tử đầu tiên *@

                        @foreach (var item in Model)
                        {
                            <div class="carousel-item @(firstItem ? "active" : "")">
                                <img src="@item.BannerUrl" class="d-block w-100" alt="@item.Title">
                                <div class="carousel-caption d-none d-md-block">
                                    @* <h3>@item.Title</h3> *@
                                    @* <p>@item.Description</p> *@
                                </div>
                            </div>
                            firstItem = false;  @* Sau phần tử đầu tiên, không gán active nữa *@
                        }
                    </div>


                    

                    <!-- Controls -->
                    <button class="carousel-control-prev" type="button" data-bs-target="#imageSlider" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#imageSlider" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>

            <!-- Movie Selection -->
            <div class="section" id="movie-selection">
                <h2 class="text-center mb-4 section-heading">PHIM ĐANG CHIẾU</h2>
                <div class="swiper-container movie-swiper">
                    <div class="swiper-wrapper">
                        @foreach (var item in Model)
                        {
                            <div class="swiper-slide">
                                <div class="card">
                                    <span class="badge-new">MỚI</span>
                                    <img src="@item.PosterUrl" class="card-img-top" alt="@item.Title">
                                    <div class="card-body">
                                        <h5 class="card-title">@item.Title</h5>
                                        <p class="card-text"><small><i class="fas fa-clock"></i> @item.Duration phút</small></p>
                                        <div class="d-flex justify-content-between">
                                            <a asp-controller="Movie" asp-action="Details" asp-route-id="@item.Id" class="btn btn-primary">
                                                Chi tiết
                                            </a>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                </div>
            </div>
        </div>

        

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
    <script src="~/js/movie.js"></script>
        @section Scripts {
            <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
            <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css" />
            <script>
                $(document).ready(function () {
                    // Autocomplete
                    $("#SearchProduct").autocomplete({
                        source: function (request, response) {
                            $.ajax({
                                url: "/Movie/Search",
                                type: "GET",
                                data: { term: request.term },
                                success: function (data) {
                                    response($.map(data, function (item) {
                                        return {
                                            label: item.label,
                                            value: item.label,
                                            id: item.value
                                        };
                                    }));
                                }
                            });
                        },
                        minLength: 1,
                        select: function (event, ui) {
                            window.location.href = "/Movie/Details/" + ui.item.id;
                        }
                    });

                    // Bấm nút Search
                    $("#searchButton").on("click", function () {
                        var term = $("#SearchProduct").val();
                        if (term.length > 0) {
                            $.get("/Movie/Search", { term: term }, function (data) {
                                if (data.length > 0) {
                                    window.location.href = "/Movie/Details/" + data[0].value;
                                } else {
                                    alert("Không tìm thấy phim.");
                                }
                            });
                        }
                    });
                });
            </script>
        }
</body>
</html>